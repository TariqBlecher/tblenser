Glafic test:

glafic doing via a hack of lens_parametric srcs. hmmm I think I'll have to backtrack to lens_parametric sources because
I need to use the same cosmological model and change prefixes (unless I can think of a hack to get around prefixes?)
so ya at the moment just working on the pycharm side.

defmap side of the test is done. Output parmtrack files which can then be input into glafic

cutout margin bug fixing. Cutout margins can cause serious trouble if margin extends beyond image boundary

---------------------------------------
Minor bug for tiny, highly inclined sources where the small grids introduce interpolation errors. decreasing min grid size to 3.

fixed some bugs in redshift sampling

inclination problem is solved. everything looking good except that the magnifications are very low. Good magnification evolution with redshift.

Need to pad edges for interpolation - done

Magnification is still anti-correlating strongly with inclination. Trying with a 4x interpolated map. Taking substantially longer to run.

serious problems for very high HI mass m>11.3 . Fix does not seem to be working. magnification explodes. check fix - works

fixed with zoom but now I need an adjustable zoom based on the extent of the HI image
magnification seems correlated with inclination which suggests a sampling bug - fixed

rdisk solver crashes for very high mhi masses > 12

Next fix is that it is good to scipy.ndimage.zoom into the image a bit to smooth over the noise. Probably a better approach would be to just
zoom the full deflection map by 2. hmmm trying both and the image zoom seems to be doing better for some reason


I've got it! I have to rescale the flux by (pixscale_defmap/pixscale_hi)^2

Ok seems like the positions are fine now but the magnifications are often less than 1 which indicates that the pixel resolution of the image
is indeed too large..I suppose an easy way to check this is to set the deflection map to zero so there's no deflection then just look at the
magnifications in that case and it should just be 1. Good way to quantify errors.

HIDISC translation written in hdr. when calculating image onedgrid takes this into account to the calculated source grid
However it seems like some or all the images are zero...check this though

HIDisk is taking toooo long. npix of cats grid is too large. need to rather just interpolate onto it.
GOing back to the original hidisk, write to fits (try use astropy module), then calc image using the source fits.
This will be nice and accurate too.

Stellar mass uncertainties not properly done. using uniform sampling for now

correct z sampling for being > cluster and < band end


just checked that all ASTRODEEP cut sources are within the cats map -> they are

two weeks ago I compared the magnifications from the deflection map vs magnifications from the magnification map.
I don't expect these to be exactly the same. They were not wildly different which was good,
